FROM node:20-slim
LABEL org.opencontainers.image.source=https://github.com/A-star-logic/memoire
WORKDIR /memoire

ENV NODE_ENV=production

ARG sentry_dsn
ENV SENTRY_DSN=${sentry_dsn}
ARG posthog_key
ENV POSTHOG_KEY=${posthog_key}


COPY --chown=node:node node_modules ./node_modules
COPY --chown=node:node dist ./dist
COPY --chown=node:node package.json .

USER node

CMD ["node", "--enable-source-maps", "dist/index.js"]